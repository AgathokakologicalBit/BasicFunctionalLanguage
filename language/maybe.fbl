: include "core.fbl"
: include "tools.fbl"


: set "MaybeType" (Type "Maybe" [ declare_property ]
    : declare_property "value"

    : declare_property "is_nothing" true
    : declare_property "is_just" false

    : declare_property >>=
)

: set "Nothing" (MaybeType [ self ]
    : self <- >>= ([ function ]
        if (self "is_nothing") ([ --- ] Nothing) function
            self
    )

    : self <- <- void
)

: set "Just" ([ value ] MaybeType [ self ]
    : self <- "value" value
    : self <- "is_nothing" false
    : self <- "is_just" true

    : self <- >>= ([ function ]
        if (self "is_nothing") ([ --- ] Nothing) function
            self
    )

    : self <- <- void
)

: (set "maybe" [ default ] [ transform ] [ mb ] run (
    if (mb "is_just")
        ([ --- ] transform (mb "value"))
        ([ --- ] default)
))

: (set "from_maybe" [ default ] [ mb ] maybe default id mb )

